# 小优妮的文明6模组笔记

## 07 美术配置初步

在先前的章节中，我们已经介绍过更新美术动作——前端动作`Feline_ConfigArt`和对局内动作`Feline_Art`，它们都加载了“模组美术依赖文件”（Mod Art Dependency File——实际上它就是大多数mod中存在的`.dep`文件）但目前为止，我们还没有定义或者导入任何图标。在本章中，我们将要涉足美术配置，包括如何导入美术文件，以及如何配置它们。我们很快就能开始导入第一批图标进入游戏，但在那之前，我们要先从美术依赖文件（.dep）以及它所要引用的美术定义文件（`.ArtDef`）以及XLP文件。

>**小道消息**：什么是XLP？
>
>尽管许多模组好手都会告诉你XLP文件是导入素材到游戏的基础，但是XLP这个缩写具体代表什么则似乎不可考。ModBuddy会将XLP文件和美术素材打包为BLP文件，我们只能猜测B指的是Binary——二进制（不以人类易读形式存储）。

要开始美术配置的旅途，必不可少却常常令人恼怒的工具是Firaxis提供的素材编辑器（Asset Editor）。许多老玩家都积累了上千字的对它以及其开发者的辱骂文案，但很遗憾它仍然是我们最好的帮手，而且没有之一。在ModBuddy中找到“工具”（TOOLS），然后选择“运行素材编辑器…”（Launch Asset Editor...）。注意，如果你此前没有配置好正确的开发素材包位置，你可能无法启动它。

![alt text](image.png)

素材编辑器可以用来编辑美术依赖文件（`.dep`）的前身——以`.art.xml`为后缀的美术指定文件（art specification document）、美术定义文件（`.ArtDef`）以及XLP文件，以及其它被导入到工程文件中的素材。我们将要做的事情原则上看非常简单——只是先加入几个图标而已，但如果你在此前已经初步了解过怎么把图标导入进工程里的XLP文件的话，此时你会发现你的图标并未被放入生成的模组成品中！

这是文明6美术配置的第一个怪癖：如果你没有配置任何`.ArtDef`文件，那么所有美术都不会生成成品。好吧，看来我们还是从`.ArtDef`开始。鉴于我们生成的模组是一个文明/领袖，我们不妨从配置与文明配置相关的`Civilizations.artdef`开始。

从工具栏中选择“新建”按钮（左起第一个），然后选择“ArtDef”。

![alt text](image-1.png)

这样就建立了一个空的美术定义文件，如图所示。

![alt text](image-2.png)

建立一个美术定义文件之后，第一件要做的事情是选择它的模板（Template）。在保存的时候，非常建议将其文件名设为和其模板一致。

![alt text](image-3.png)

选中之后，现在即可保存。路径设置为你的模组工程文件下的ArtDefs文件夹。

![alt text](image-4.png)

然后，我们右击左侧面板的Civilization目录，右键选择“添加元素”（Add Element）。

![alt text](image-5.png)

![alt text](image-6.png)

选择新生成的元素，在右侧面板中将元素命名为你的文明内部变量名，此处也即`CIVILIZATION_FELINE`。选择`Audio`子项，右键新建元素。此时你会看到这样的画面。

![alt text](image-7.png)

但这是个bug——如果子项的内容是空的，新建的元素只显示出第一列。我们点击左侧面板上的任何一个其它节点，然后重新选中`Audio`。

将我们创建的第一个元素的`Name`改为`Entry`，`XrefName`改为`England`，保存。

下一步，我们打开官方的美术素材包，在里面寻找`Civ6\pantry\Civ6.Art.xml`。打开它，然后搜索`Civilizations.artdef`。

![alt text](image-8.png)

文件中一共出现了5个结果，说明官方将`Civilizations.artdef`的内容应用到了5个素材用户（`consumer`）中：它们分别是：`Landmarks`、`Civilizations`、`Cultures`、`WorldView_Translate`以及`Audio`。

>**笔记笔记**：查找所需的素材用户项
>
>自行填写每个美术定义文件需要应用到哪些素材用户中常常极为痛苦。因此，我们应该尽量参考官方做好的配置。除了`Civ6\pantry\Civ6.Art.xml`，`Civ6\DLC\`目录下的四个DLC内容的美术依赖文件也可以用来参考。在找不到可参考的地方的情况下，还可以参考其他人写好的作品。当你在Art.xml中搜索某个artdef时，只需要向上几行，便可知道它所在的素材用户。如图所示，这表示`Civilizations.artdef`需要存在于`Landmarks`素材用户中。
>
>![alt text](image-9.png)

因此，我们依葫芦画瓢。

回到素材编辑器。选择左起第五个图标，“打开现有的美术指定文件”（Open an existing art specification document）。找到你的工程文件中的`Mod工程名.art.xml`。

![alt text](image-10.png)

![alt text](image-11.png)

结果如下。

![alt text](image-12.png)

从左侧的“素材用户”（Art Consumers）列表中，选中`Landmarks`。

![alt text](image-13.png)

然后点击`ArtDefs`右侧的白色按钮（实际上它是`Add...`，但因为bug难以看清文字），选择我们之前保存的`Civilizations.artdef`。

对我们需要调整的另外四个素材用户做同样的操作，然后保存。

你会看到这样一个警告。它提醒说，这些改动需要重启素材编辑器生效。我们稍后就会如此做，现在点击确定，暂时无视它。

![alt text](image-14.png)

所有的美术定义文件（ArtDef）都会属于一个或多个素材用户（art consumer）。与之对应的，所有的XLP文件都会属于一个素材库（Library）。很快我们就会开始新建XLP文件并在`art.xml`中引用它们。下一个需要注意的项目是依赖（Dependencies）。这是文明6的美术素材编辑系统的第二个怪癖：无论你的模组支持哪一个规则集什么时候，你都应当在制作时选择Expansion2。但是，在生成的成品中，除非你的模组只能在风云变幻资料片下运行，否则又应该无论何时都保持成品不依赖任何内容，否则它将在没有资料片的情况下不显示任何美术。在你预备发布你的作品的时候，需要手动修改生成完成的`.dep`文件。万幸的是，这个文件在搭建完成模组的基本框架之后就不需要再改动，因此可以备份一份，每次生成完成后粘贴一遍——或者更好的办法是使用版本控制系统保持它在调好的状态。

>**笔记笔记**：清除美术依赖
>
>制作时必须依赖，做好了必须不依赖，文明6的美术系统就是这么令人疯狂。前往游戏的本地模组文件夹（`文档\My Games\Sid Meier's Civilization VI\Mods\`），找到你新生成的成品模组，然后打开它的`.dep`文件
>
>![alt text](image-15.png)
>
>然后将
>
>```xml
>	<RequiredGameArtIDs>
>		<Element>
>			<name text="Expansion2"/>
>			<id text="b1b63999-6b16-4dd2-a5b6-eb19794aa8ca"/>
>		</Element>
>	</RequiredGameArtIDs>
>```
>
>替换为
>
>```xml
>	<RequiredGameArtIDs/>
>```
>
>保存。如果你希望你的作品在没有风云变幻资料片时也能工作，务必在作品发布前修复你的`.dep`文件。

在开始导入图标之前，先生成你的作品，进入游戏建立第一座城市。如果此时你能听到英国的背景音乐，那么说明你到这一步为止的配置已经成功，接下来我们正式进入图标导入。

>**小道消息**：关于音乐……
>
>是的，在刚才的操作中，我们通过在`Civilizations.artdef`中定义了文明的`Audio`属性来引用了游戏官方的文明音乐。如果你打算引用游戏内其它文明的音乐（越南和葡萄牙除外，无法直接引用葡萄牙和越南的文明音乐），都可以使用这个办法。
>
>这种方法的缺点是无法导入更多自己的音乐，且不影响领袖外交面板的背景音乐（外交面板音乐通过`Leaders.artdef`，但它又和加载过程中的语音绑定。由于官方音频配置的问题，加载语音（官方称作 Dawn of Man 语音）的实现极其困难且不同模组无法相互兼容，一种有希望实现的兼容手段也必须重写加载界面）。
>
>若你要导入自己的音乐，则应该回过头来删除刚才我们在`Audio`下建立的`Entry`元素（选择`Entry`，然后点击工具栏上的按钮，如图所示——要在素材编辑器中删除元素时，点击右键不一定可行，选中后点击工具栏按钮更容易成功），然后遵循为模组添加自定义音乐的步骤。
>
>![alt text](image-16.png)

