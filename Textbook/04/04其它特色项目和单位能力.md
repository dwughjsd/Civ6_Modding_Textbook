# 优妮酱的文明6mod笔记本

## 04 其它特色项目和单位能力

在上一章节中，我们已创建了一个文明的特性，不过距离完成我们的整个领袖的游戏性部分还有一段十足的距离。本教程中我们将继续完成一个简单的特色建筑。本章需要你已经完成了之前的部分。如果你还没有完成，请务必先看一看你的文明是否已经配置完毕！让我们翻回我们的设定草稿： 

**猫咪贾斯伯领导的猫猫族** Jasper Kitty leads the Felines

<input type="checkbox" > 领袖特性：**猫猫爪击** Kitty Claws

所有陆地单位获得+10战斗力。

<input type="checkbox" checked> 文明特性：**猫式迅捷** Cat-Like Reflexes

首都的所有产出翻倍。

<input type="checkbox" > 特色单位：**猫咪** Kitten

替代侦察兵。比侦察兵的行动力更高，且可以无视树林地形的移动力惩罚。

<input type="checkbox" > 特色基础设施：**猫砂盆** Litter Box

一种特色建筑，替代纪念碑。提供2点文化产出和2点忠诚度。如果忠诚度满，额外产出2点文化。

在本章中，我们需要完成剩下的三个项目。这次我们将从特色基础设施入手，然后再提到特色单位和领袖专属的单位加成特性。

如果担心代码混乱的话，非常推荐将建筑放在单独的XML数据库指令文件中，可以取名为`Feline_JasperKitty_Buildings.xml`（下面我们也会略去前缀部分）。同时，别忘了这个文件也需要被游戏在运行时加载，因此需要将其放入我们之前定义的Feline_Gameplay游戏内动作（in-game action）。（如果你不记得如何设置游戏内动作，请参阅02章）。

在本章中，我们将介绍Buildings等数据表的使用，建立一个新的建筑并使其成为特色建筑。我们的第一步是编写出猫砂盆建筑本身。现在，我们的Buildings.xml文件中应该有这些东西：

```xml
<?xml version="1.0" encoding="utf-8"?>  
<GameData>  
    <Types>  
        <Row Type="BUILDING_LITTER_BOX" Kind="KIND_BUILDING" />  
    </Types>  
    <Buildings>  
        <Row BuildingType="BUILDING_LITTER_BOX" Name="LOC_BUILDING_LITTER_BOX_NAME" Description="LOC_BUILDING_LITTER_BOX_DESCRIPTION" PrereqDistrict="DISTRICT_CITY_CENTER"  PurchaseYield="YIELD_GOLD" Cost="60" AdvisorType="ADVISOR_CULTURE"/>  
    </Buildings>  
    <Building_YieldChanges>  
        <Row BuildingType="BUILDING_LITTER_BOX" YieldType="YIELD_CULTURE" YieldChange="2"/>  
    </Building_YieldChanges>  
    <BuildingModifiers>  
        <Row BuildingType="BUILDING_LITTER_BOX" ModifierId="LITTER_BOX_LOYALTY"/>  
        <Row BuildingType="BUILDING_LITTER_BOX" ModifierId="LITTER_BOX_CULTURE_AT_FULL_LOYALTY"/>  
    </BuildingModifiers>  
    <Modifiers>  
        <Row>  
            <ModifierId>LITTER_BOX_LOYALTY</ModifierId>  
            <ModifierType>MODIFIER_SINGLE_CITY_ADJUST_IDENTITY_PER_TURN</ModifierType>  
        </Row>  
        <Row>  
            <ModifierId>LITTER_BOX_CULTURE_AT_FULL_LOYALTY</ModifierId>  
            <ModifierType>MODIFIER_SINGLE_CITY_ADJUST_YIELD_CHANGE</ModifierType>  
            <SubjectRequirementSetId>MONUMENT_FULL_LOYALTY_REQUIREMENTS</SubjectRequirementSetId>  
        </Row>  
    </Modifiers>  
    <ModifierArguments>  
        <Row>  
            <ModifierId>LITTER_BOX_LOYALTY</ModifierId>  
            <Name>Amount</Name>  
            <Value>2</Value>  
        </Row>  
        <Row>  
            <ModifierId>LITTER_BOX_CULTURE_AT_FULL_LOYALTY</ModifierId>  
            <Name>Amount</Name>  
            <Value>2</Value>  
        </Row>  
        <Row>  
            <ModifierId>LITTER_BOX_CULTURE_AT_FULL_LOYALTY</ModifierId>  
            <Name>YieldType</Name>  
            <Value>YIELD_CULTURE</Value>  
        </Row>  
    </ModifierArguments>  
</GameData>  
```

我们来详细解说一下这段内容。和其他文件一样，所有你做出的指令都必须在GameData的起终点之间。

和很多其他游戏内元素一样，新建建筑也需要你在`Types`表中进行声明。建筑物的基本信息是记录在`Buildings`表中的。`BuildingType`是这个建筑的内部名称，它也是这个建筑的唯一标识符。`Name`和`Description`是它的名称和说明的本地化变量。

`PrereqDistrict`指示它的前置区域，此处是市中心。`PurchaseYield`表示购买本建筑使用的产出类型，许多建筑都使用金币（`YIELD_GOLD`），不过也有一些使用的是信仰（`YIELD_FAITH`）。`Cost`是其基本成本（标准速度下，没有任何其它加成时的生产力造价）。`AdvisorTyoe`是旧作的遗留产物，也许会影响AI建造它的方式，原本的意思是游戏内顾问为你进行推荐时选择的推荐类型（在文明5中，游戏会显示“您的经济/军事/文化顾问推荐您建造这个”，但如今不会了）。

>**笔记笔记**：参照官方数据
>
>在编写属于你自己的内容的时候，官方的文件是非常好的参考。他们实现一样东西的方法有可能对你也适用。尝试着模仿官方文件吧！
Building_YieldChanges表记载本建筑的基础产出类型。这一建筑的基础产出是2点文化。你可能会说，“那满忠诚度时的额外2点文化在哪里呢“——它是以修正的形式存在的。BuildingModifiers表将这一建筑与修正绑定起来，也就是，这一建筑自带的一部分特殊效果。本建筑自带了两个修正：LITTER_BOX_LOYALTY（单城增加忠诚度，每回合2点），以及LITTER_BOX_CULTURE_AT_FULL_LOYALTY（单城，满忠诚度时，增加产出，每回合2点文化）。

现在你就可以构建你的作品，试试看它的效果是否可用。你此时应该会注意到新建筑已经出现，但它并没有像我们设想的那样成为本文明的专属建筑，也没有替代纪念碑！别着急，你可以先确认建筑本身是否可用，我们接下来就要谈到这一点。

在文明6中，建筑物、城区、改良设施或者单位可以被设置为必须要有某种特性（trait）才能使用。特性本身也可以和修正进行绑定（也就是文明/领袖特性），但有些特性本身没有绑定修正，而是作为领袖/文明和特色项目的纽带存在（也就是特色物件）。

设置一个特色物件的第一步是使其出现在领袖选择界面。在领袖选择界面，我们的这个建筑实际上根本就还未被游戏读取（别忘了，`Buildings.xml`仅仅被放置在游戏内动作而不是前端动作中读取），因此我们需要在`Config.xml`中提前报告它的存在。在这个过程中，我们需要使用的是`PlayerItems`表。在`Config.xml`中试试看吧！

```xml
<PlayerItems>  
    <Row>  
        <Domain>Players:Expansion2_Players</Domain>  
        <CivilizationType>CIVILIZATION_FELINE</CivilizationType>  
        <LeaderType>LEADER_JASPER_KITTY</LeaderType>  
        <Type>BUILDING_LITTER_BOX</Type>  
        <Name>LOC_BUILDING_LITTER_BOX_NAME</Name>  
        <Description>LOC_BUILDING_LITTER_BOX_DESCRIPTION</Description>  
        <Icon>ICON_BUILDING_LITTER_BOX</Icon>  
        <SortIndex>10</SortIndex>  
    </Row>  
</PlayerItems>  
```

很容易理解这其中的大多数内容：Domain代表显示此条目的游戏规则集，紧接着的是文明、领袖、特色物件的类型、其名称、描述和图标。特别需要注意的是SortIndex，这个属性决定这一项特色物件在领袖选择界面的排序。数字越小，它会越靠前。不过，它不会显示在文明特性之前。

设置完成后，可以在领袖选择界面看到你设置的条目。文本和图标目前还尚未设置完毕，我们将会在将来提及，因此下图就是正确的模样了。

![alt text](image.png)

不过我们还是得继续设置，才能让这个建筑变成我们文明的专属建筑。

回到Buildings表，这个表是建筑物的基础信息的记录处。如果你试着自由地翻找文明6原版游戏的Buildings.xml，你可能会注意到这些记录包含了一些并不是所有建筑都有的字段——比如说TraitType——也就是建设此建筑的玩家必须拥有的特性（trait）。

<Row BuildingType="BUILDING_LITTER_BOX" Name="LOC_BUILDING_LITTER_BOX_NAME" Description="LOC_BUILDING_LITTER_BOX_DESCRIPTION" PrereqDistrict="DISTRICT_CITY_CENTER"  PurchaseYield="YIELD_GOLD" Cost="60" AdvisorType="ADVISOR_CULTURE"/>  

我们需要做的，就是给我们的新建筑补上关于TraitType的数据——这样这个建筑就只能由拥有拥有该特性的玩家建造。另一方面，我们要给我们的文明赋予这个特性，于是我们的新文明便成为了唯一能建造这种建筑的文明（“玩家”可以获得文明以及领袖两者的特性）。

试着改写Buildings表里关于这个新建筑的数据吧，下面是参考答案（XML的同一条数据内，字段顺序没有影响。需要注意的是使用SQL的话则有影响）：

<Row BuildingType="BUILDING_LITTER_BOX" Name="LOC_BUILDING_LITTER_BOX_NAME" Description="LOC_BUILDING_LITTER_BOX_DESCRIPTION" PrereqDistrict="DISTRICT_CITY_CENTER" PurchaseYield="YIELD_GOLD" Cost="60" TraitType="TRAIT_CIVILIZATION_BUILDING_LITTER_BOX" AdvisorType="ADVISOR_CULTURE"/>  

现在，还没有任何人能够建造这个建筑。因为还没有任何文明或者领袖拥有这个特性。实际上，如果你现在就急急忙忙地生成你的作品的话，你将会得到一个错误，显示你添加的这个建筑物的数据库信息不符合外键（FOREIGN KEY）约束——因为甚至这个特性还没有被声明呢！
在任何游戏内动作中被加载的数据库指令文件里面都可以声明这个特性并把其绑定给文明或领袖。我们在此处按照惯例，将特性放在Civilizations.xml中进行声明，如图所示，自行添加新条目。

![alt text](image-1.png)

![alt text](image-2.png)
  
我们来复习一下，我们在Types表中声明这个特性，并在Traits表中描述其详细信息。特别的是，特色建筑、特色单位等等特色物件所依附的特性不需要名称和描述，因此只要写一行没有额外信息的条目，表示这个东西确实存在即可。遗憾的是，这个形式主义味道满满的“画蛇添足”是不能省略的。
接下来，我们在CivilizationTraits表中将这个特性与我们的文明绑定。接下来试着生成你的作品并进行测试吧。
 这次我们看到了“一种特色建筑”，这就代表这个建筑和文明的绑定成功了。不过，我们似乎还有一些事情要做……回忆一下我们的设计稿。

 ![alt text](image-3.png)

特色基础设施：猫砂盆 Litter Box

一种特色建筑，**替代纪念碑**。提供2点文化产出和2点忠诚度。如果忠诚度满，额外产出2点文化。
 
是的，替代！我们需要在BuildingReplaces表中记录它是纪念碑的替代。回到Buildings.xml，补上： 

```xml
<BuildingReplaces>  
    <Row CivUniqueBuildingType="BUILDING_LITTER_BOX" ReplacesBuildingType="BUILDING_MONUMENT"/>  
</BuildingReplaces>  
```

到这里，特色建筑的游戏数值就正式编写完成。生成你的mod并进行测试——你应该能看到你的文明现在有一个替代纪念碑的特色建筑了（在百科中可以重点关注它是否已经取代了纪念碑且特属于你所写的文明）。如果有什么无法生效，就回到上一步试试吧！
 
完成这一步之后，我们随即要来制作特色单位。如同建筑一样，我们给单位也准备一个新的 XML 文件为宜。别忘了在游戏内动作（In-game Actions）中加载它。和建筑一样，特色单位往往也单独有一条启用它的特性（trait），你现在就可以补上它了。
