# 小优妮的文明6模组笔记

## 10 完善配置

现在，我们的领袖的配置已经初具雏形。我们拥有了（基本上）能运作的领袖能力，配置了美术文件，但它现在距离完整还有一大段！本章中我们将继续完善文明和领袖的配置。

让我们回到`Leaders.xml`，来为我们的领袖增加议程和AI偏好。既然我们的领袖是只基米，那我们就让它哈哈气！

议程：耄耋 Territorial

喜欢远离自己的文明，敌视与自己相邻的文明。

这是一个与随机议程中的“偏执狂”相似的议程，因此我们接下来还会定义令它不要和这个随机议程同时出现——接着往下看就能看到。

本质上，议程的效果是通过一个新设的特性（Trait）生效的，因此我们首先需要先定义这个特性。

```xml
	<Types>
		<Row Type="TRAIT_AGENDA_TERRITORIAL_CAT" Kind="KIND_TRAIT"/>
	</Types>

	<Traits>
		<Row TraitType="TRAIT_AGENDA_TERRITORIAL_CAT" />
	</Traits>
```

然后我们定义它的效果。


```xml
	<TraitModifiers>
		<Row TraitType="TRAIT_AGENDA_TERRITORIAL_CAT" ModifierId="AGENDA_TERRITORIAL_CAT_NEIGHBORS"/>
		<Row TraitType="TRAIT_AGENDA_TERRITORIAL_CAT" ModifierId="AGENDA_TERRITORIAL_CAT_NOT_NEIGHBORS"/>
	</TraitModifiers>
	<Modifiers>
		<Row>
			<ModifierId>AGENDA_TERRITORIAL_CAT_NEIGHBORS</ModifierId>
			<ModifierType>MODIFIER_PLAYER_DIPLOMACY_SIMPLE_MODIFIER</ModifierType>
			<SubjectRequirementSetId>PLAYERS_ARE_NEIGHBORS</SubjectRequirementSetId>
		</Row>
		<Row>
			<ModifierId>AGENDA_TERRITORIAL_CAT_NOT_NEIGHBORS</ModifierId>
			<ModifierType>MODIFIER_PLAYER_DIPLOMACY_SIMPLE_MODIFIER</ModifierType>
			<SubjectRequirementSetId>PLAYERS_ARE_NOT_NEIGHBORS</SubjectRequirementSetId>
		</Row>
	</Modifiers>
	<ModifierArguments>
		<Row>
			<ModifierId>AGENDA_TERRITORIAL_CAT_NEIGHBORS</ModifierId>
			<Name>InitialValue</Name>
			<Value>-8</Value>
		</Row>
		<Row>
			<ModifierId>AGENDA_TERRITORIAL_CAT_NEIGHBORS</ModifierId>
			<Name>StatementKey</Name>
			<Value>LOC_DIPLO_WARNING_EXIT_LEADER_JASPER_KITTY_ANY</Value>
		</Row>
		<Row>
			<ModifierId>AGENDA_TERRITORIAL_CAT_NEIGHBORS</ModifierId>
			<Name>SimpleModifierDescription</Name>
			<Value>LOC_DIPLO_MODIFIER_TERRITORIAL_CAT_NEIGHBOR</Value>
		</Row>
		<Row>
			<ModifierId>AGENDA_TERRITORIAL_CAT_NOT_NEIGHBORS</ModifierId>
			<Name>InitialValue</Name>
			<Value>8</Value>
		</Row>
		<Row>
			<ModifierId>AGENDA_TERRITORIAL_CAT_NOT_NEIGHBORS</ModifierId>
			<Name>StatementKey</Name>
			<Value>LOC_DIPLO_KUDO_EXIT_LEADER_JASPER_KITTY_ANY</Value>
		</Row>
		<Row>
			<ModifierId>AGENDA_TERRITORIAL_CAT_NOT_NEIGHBORS</ModifierId>
			<Name>SimpleModifierDescription</Name>
			<Value>LOC_DIPLO_MODIFIER_TERRITORIAL_CAT_NOT_NEIGHBOR</Value>
		</Row>
	</ModifierArguments>
	<ModifierStrings>
		<Row ModifierId="AGENDA_TERRITORIAL_CAT_NEIGHBORS" Context="Sample" Text="LOC_TOOLTIP_SAMPLE_DIPLOMACY_ALL"/>
		<Row ModifierId="AGENDA_TERRITORIAL_CAT_NOT_NEIGHBORS" Context="Sample" Text="LOC_TOOLTIP_SAMPLE_DIPLOMACY_ALL"/>
	</ModifierStrings>
```

这个议程使用的两个修正（Modifiers）的类型是最简单最普适的——`MODIFIER_PLAYER_DIPLOMACY_SIMPLE_MODIFIER`，这是一个专用于议程的修正类型，能够比较好地正常工作（遗憾的是它使用的条件集（RequirementSet）则基本上专用于外交场合，无法用于其它效果）。`ModifierStrings`的作用在于让外交面板正确显示外交关系变化的原因（如果没有正确配置，则会显示为“未知原因”），具体显示的文字；它的`Text`部分则不需要改动，而是保留现状。`ModifierArguments`方面，具体显示的原因分别由两个修正的`SimpleModifierDescription`定义。`StatementKey`的用处则是定义议程生效时显示的台词。`InitialValue`字面意思是“初值”，由于我们设置的是一个简单的外交态度变化，因此没有其它变化量，其它具体参数可以从游戏文件中供读者慢慢探寻。

第三部分定义了议程的其它细节：

```xml
	<Agendas>
		<Row AgendaType="AGENDA_TERRITORIAL_CAT" Name="LOC_AGENDA_TERRITORIAL_CAT_NAME" Description="LOC_AGENDA_TERRITORIAL_CAT_DESCRIPTION"/>
	</Agendas>

	<HistoricalAgendas>
		<Row LeaderType="LEADER_JASPER_KITTY" AgendaType="AGENDA_TERRITORIAL_CAT"/>
	</HistoricalAgendas>

	<AgendaTraits>
		<Row AgendaType="AGENDA_TERRITORIAL_CAT" TraitType="TRAIT_AGENDA_TERRITORIAL_CAT"/>
	</AgendaTraits>

	<ExclusiveAgendas>
		<Row AgendaOne="AGENDA_TERRITORIAL_CAT" AgendaTwo="AGENDA_PARANOID"/>
	</ExclusiveAgendas>
```

从上到下分别定义了一种议程，将这种议程绑定到一个领袖身上（注意，在刚才我们没有把我们编写的议程特质通过`LeaderTraits`表绑定给领袖。议程特质需要先绑定给一个议程，然后再将这个议程绑给领袖。），定义了议程对应的特质，以及与它属性相近或相反的议程（以免随机议程相互抵消或者效果相同）。

下一步是补充文本。示例内容如下：

```xml
		<Row Tag="LOC_AGENDA_TERRITORIAL_CAT_NAME" Language="en_US">
			<Text>Territorial</Text>
		</Row>
		<Row Tag="LOC_AGENDA_TERRITORIAL_CAT_DESCRIPTION" Language="en_US">
			<Text>Likes civilizations who settle at a distance. Dislikes any civilizations encroaching on Feline territory.</Text>
		</Row>
		<Row Tag="LOC_DIPLO_MODIFIER_TERRITORIAL_CAT_NEIGHBOR" Language="en_US">
			<Text>Jasper Kitty is disturbed by you settling near one of his cities.</Text>
		</Row>
		<Row Tag="LOC_DIPLO_MODIFIER_TERRITORIAL_CAT_NOT_NEIGHBOR" Language="en_US">
			<Text>Jasper Kitty is pleased that you settled far away from his empire.</Text>
		</Row>

		<Replace Tag="LOC_AGENDA_TERRITORIAL_CAT_NAME" Language="zh_Hans_CN">
			<Text>耄耋</Text>
		</Replace>
		<Replace Tag="LOC_AGENDA_TERRITORIAL_CAT_DESCRIPTION" Language="zh_Hans_CN">
			<Text>喜欢在远方定居的文明；讨厌蚕食猫猫族领土的文明。</Text>
		</Replace>
		<Replace Tag="LOC_DIPLO_MODIFIER_TERRITORIAL_CAT_NEIGHBOR" Language="zh_Hans_CN">
			<Text>猫咪贾斯伯不满你在他的城市附近定居</Text>
		</Replace>
		<Replace Tag="LOC_DIPLO_MODIFIER_TERRITORIAL_CAT_NOT_NEIGHBOR" Language="zh_Hans_CN">
			<Text>猫咪贾斯伯很高兴您远离他的帝国定居</Text>
		</Replace>
```

（很遗憾，虽然贾斯伯是公猫，但我们提供的素材包给了他一套女装。）

>**笔记笔记**：女性
>
>`Leaders`表中提供一个`Sex`字段，可以指定领袖是男性或女性。这一字段仅在迭起兴衰和风云变幻资料片中正确定义，且对目前版本的游戏毫无意义。在早期版本中，领袖有可能获得喜欢异性或喜欢同性的随机议程，这个字段便是在此时起效的。你可以不为你的领袖填写性别（若不填写，默认为男），这不会影响没有安装其它模组的游戏。不过，一些模组可能会重新使用这个信息，因此填写它也不是件坏事。

那么议程生效的台词呢？别担心，我们接下来就会和其它台词一并处理。在那之前，我们先前往需要在`Leaders.xml`处理完毕的另一个话题：AI偏好。

合理地设置AI偏好可以让AI的表现稍微提升一些，也能够让它更容易做出符合领袖性格的行为（尽管不得不承认，文明6的AI非常糟糕，因而难以真正达成这一点）。大体上，调整AI的行为可以分为两种路径：“偏好”和“伪产出系数”。这两种方式分别对应于不同的领域——大部分领域都只能通过偏好调整，这之中又分为正偏好和副偏好；而对于伪产出系统（PseudoYields），则可以通过一个系数调整AI对某一种游戏内元素的重视程度。

大部分官方领袖都为其领袖AI定义了偏好的科技、市政和奇观，有些还定义了伪产出（其中又有一部分不是直接绑定给领袖，而是通过偏好特质予以间接绑定的）。下面我们来试着做一做。

```xml
	<AiListTypes>
		<Row ListType="JasperKittyTechs"/>
		<Row ListType="JasperKittyCivics"/>
		<Row ListType="JasperKittyWonders"/>
	</AiListTypes>

	<AiLists>
		<Row ListType="JasperKittyTechs" LeaderType="TRAIT_LEADER_KITTY_CLAWS" System="Technologies"/>
		<Row ListType="JasperKittyWonders" LeaderType="TRAIT_LEADER_KITTY_CLAWS" System="Buildings"/>
		<Row ListType="JasperKittyCivics" LeaderType="TRAIT_LEADER_KITTY_CLAWS" System="Civics"/>
	</AiLists>

	<AiFavoredItems>
		<Row ListType="JasperKittyTechs" Item="TECH_ANIMAL_HUSBANDRY" Favored="true"/>
		<Row ListType="JasperKittyCivics" Item="CIVIC_EARLY_EMPIRE" Favored="true"/>
		<Row ListType="JasperKittyWonders" Item="BUILDING_PYRAMIDS" Favored="true"/>
	</AiFavoredItems>
```

声明、定义、具体配置，一气呵成。

对于科技、市政这样的系统（System），设置`Favored="true"`可以提高AI在权重相同时优先选择的概率。颇为讽刺的是，科技和市政的选择权重几乎永远也不会相同（在AI日志文件中可以查看），因此正如你现在想的那样——这些设置很少真正发挥作用。

对于建筑（主要是奇观）或者区域等系统，这个AI偏好系统依然起不了太多作用，区别在于虽然`Favored="true"`只会略微提升AI的建造量，但`Favored="false"`会显著减少AI建造的概率，甚至经常完全阻止它选择建造。

对于外交动作（DiplomaticActions）这样的例子，这个系统起的作用稍明显一些，会使AI变得明显更容易或更不容易发起或接受某种外交动作（例如宣布友谊或发起突袭战争）。

关于伪产出系统，我们则再来看一个范本，如果你喜欢的话也可以将其放入你的代码中：

```xml
	<AiListTypes>
		<Row ListType="JasperKittyNukePreference"/>
	</AiListTypes>

	<AiLists>
		<Row ListType="JasperKittyNukePreference" LeaderType="TRAIT_LEADER_KITTY_CLAWS" System="PseudoYields"/>
	</AiLists>
	
	<AiFavoredItems>
		<Row ListType="JasperKittyNukePreference" Item="PSEUDOYIELD_NUCLEAR_WEAPON" Value="20"/>
	</AiFavoredItems>
```

这组指令将拥有对应特质的领袖的核弹偏好提高20%。如果一枚核弹在其它AI眼中价值25点产出，那么在它眼中就价值30点。伪产出完整的清单则可以通过数据库的`PseudoYields`表查看，或者在官方文件中搜索所有和`PseudoYields`有关的指令查阅。

另一种改变AI偏好的方法是为其绑定通用的领袖特质。例如：

```xml
	<LeaderTraits>
		<Row LeaderType="LEADER_JASPER_KITTY" TraitType="TRAIT_LEADER_SCIENCE_MAJOR_CIV"/>
	</LeaderTraits>
```

这将指定它成为一个偏好科技的领袖。类似的特质还有：TRAIT_LEADER_EXPANSIONIST（偏好扩张）、TRAIT_LEADER_NONRELIGIOUS_MAJOR_CIV（不追求宗教胜利）、TRAIT_LEADER_RELIGIOUS_MAJOR_CIV（偏好信仰）、TRAIT_LEADER_CULTURAL_MAJOR_CIV（偏好文化）、TRAIT_LEADER_AGGRESSIVE_MILITARY（好战）等。它们实际上也通过AI List影响AI的表现。例如，TRAIT_LEADER_SCIENCE_MAJOR_CIV为领袖增加了`FavorScienceVictory`AI List，调整了AI的策略（Strategies）系统，使其更重视科技胜利。

在Leaders.xml还有最后一件小事：领袖的语录。

```xml
	<LeaderQuotes>
		<Row LeaderType="LEADER_JASPER_KITTY" Quote="LOC_LEADER_JASPER_KITTY_QUOTE" QuoteAudio="FELI_JK_MISC_PEP_TALK_A"/>
	</LeaderQuotes>
```

`LeaderQuotes`指定了领袖在文明百科中显示的语录及其对应语音。我们将来会配置正确的语音的，但目前我们得先完成XML部分。

完成了我们在Leaders.xml的所有工作（可以小小庆贺一下！）之后，接下来我们切换回文本部分。先前我们提过议程生效时显示的文本，现在我们就要和其它领袖一起处理。领袖文本由一个自动化规则统一处理，因此我们不需要专门定义如何引用它，只需要填写本地化标签（Tag）合适的文本内容就可以了。我们专门为官方领袖使用的文本建立了一个表，列举了你可能需要事先准备的所有语句！这张表并不是台词系统的全部，如果你想让你的领袖表现出更加丰富多样的文本，你还可以自行探索它的具体用法。但现在，让我们聚焦在这些语句中吧。

（补图）

我们的辅助用表附带了一些便于你填入游戏文本的公式，你可以将它们整段复制进你的游戏文本文件。

到这一步，你可以开始测试一切是否正常工作，不过别忘了，这次你的领袖位于AI位，你应该换用不同的领袖。目前，领袖会在与你见面时保持静音不动数秒，这个停顿时间是为领袖音频做准备的，将来我们再处理它。现在，你可以点击鼠标右键或Esc跳过静止画面。记得你的重点是检查台词和语音是否正常！

（施工中——————————————————————————————————————————————————————————）

我们继续完成领袖的文本收尾工作。填写领袖的文明百科和领袖加载台词。顺带，一并处理完文明的百科和特色建筑单位的百科吧。

然后是Civilizations.xml的进一步完善。随机城市命名深度、种族、人名、城市名、资料卡、起始点关联、音乐覆盖、XP2特殊地名。

如此这般我们便能前进到最后的堡垒：音乐！

最后一步是上传到工坊。这样我们便能写总结陈词了！

